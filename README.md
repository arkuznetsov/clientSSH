# Oscript SSH client 

## SSH клиент для oscript

## Примеры использования
### SSH клиент

```bsl
#Использовать clientSSH
    
КлиентSSH = Новый КлиентSSH("127.0.0.1", 22, "user", "password");
Соединение = КлиентSSH.ПолучитьСоединение();
Результат = Соединение.ВыполнитьКоманду("echo 123");   
    
Соединение.Разорвать();

```

### Клиент для конфигуратора в режиме Агента 

Запустить конфигуратор в режиме агента:  
`
1cv8.exe DESIGNER /F"<ПутьКБазе>" /AgentMode /Visible /AgentSSHHostKeyAuto /AgentBaseDir "<ПутьКПапкеВыгрузки>"
`


```bsl
#Использовать clientSSH

КлиентSSH = Новый КлиентSSH("127.0.0.1", 1543, "admin", "");
Поток = КлиентSSH.ПолучитьПоток();
// Обязательно иначе вешается
Результат = Поток.ЗаписатьВПоток("options set --show-prompt=no --output-format=json");
Результат = Поток.ЗаписатьВПоток("common connect-ib");
Результат = Поток.ЗаписатьВПоток("config dump-config-to-files --dir .");
Результат = Поток.ЗаписатьВПоток("common disconnect-ib");

Поток.Разорвать();

```


### Авторизация ssh с ключом

```bsl
#Использовать clientSSH
    
КлиентSSH = Новый КлиентSSH("127.0.0.1", 22, "user", "");
КлиентSSH.УстановитьКлюч("ПутьКСекретномуКлючу", "СекретнаяФраза");
Соединение = КлиентSSH.ПолучитьСоединение();
Результат = Соединение.ВыполнитьКоманду("echo 123");   
    
Соединение.Разорвать();

```

### Передача файлов

```bsl
#Использовать clientSSH
    
КлиентSSH = Новый КлиентSSH("127.0.0.1", 1543, "admin", "");
Scp = КлиентSSH.ПолучитьScp();
Scp.ОтправитьФайл("C:\cf\1Cv8.cf", "/1Cv8.cf");

Scp.ПолучитьФайл("/1Cv8.cf", "C:\cf\1Cv8_2.cf");
Scp.Разорвать();

```





## Известные проблемы:
* Вешается поток если не передать:  
 `Поток.ЗаписатьВПоток("options set --show-prompt=no --output-format=json");`  
 * В папке выгрузки создается подпапка с именем пользователя (Особенность режима Агента)

## COM-объект для работы из 1С:Предприятие

Реализация библиотеки в виде COM-объекта для использования из 1С:Предприятие

##Установка
1. Импортируем подсистему БиблиотекаКлиентSSH в свою конфигурацию
2. Сохраняем содержимое макета COMОбъектБиблиотекаКлиентSSH_БинарныеФайлы как zip-архив
3. Разархивируем содержимое архива на диск
4. Регистрируем библиотеку

```
regasm /codebase ПутьКДлл\SshDataProcessorCom.dll
```

5. Создаем пустое COM+ приложение и добавляем нижеследующие типы:
-SshDataProcessor.ScpCom
-SshDataProcessor.SshClientCom
-SshDataProcessor.SshConnectionCom
-SshDataProcessor.SshDataProcessorCom
-SshDataProcessor.StreamCom

## Пример использования

```1C
// Нижеследующий код используется вместо стандартного
// КлиентSSH = Новый КлиентSSH("127.0.0.1", 1543, "admin", "");
//
КлиентSSH = Обработки.ФункцииКлиентSSH.НовыйКлиентSSH("127.0.0.1", 1543, "admin", "");
// Дальнейшее использование аналогично использованию в среде OneScript
```

## COM-объект для работы из 1С:Предприятие

Реализация библиотеки в виде COM-объекта для использования из 1С:Предприятие
##Установка
1. Импортируем подсистему БиблиотекаКлиентSSH в свою конфигурацию
2. Сохраняем содержимое макета COMОбъектБиблиотекаКлиентSSH_БинарныеФайлы как zip-архив
3. Разархивируем содержимое архива на диск
4. Регистрируем библиотеку
